const t=function(t){return"string"==typeof t},e=function(t){return"function"==typeof t};function r(t,e,r){this.name=t,this.id=e,this.func=r}function n(){const n=[],i=[],s=(t,e)=>{let r=n.length;for(;r;)if(r-=1,n[r].name===t&&n[r].id===e)return r;return-1};this.register=(i,u,l)=>{const f=i;let o=l,h=u;if(e(h))if(t(o)){const t=o;o=h,h=t}else o=u,h="all";if(!f)return;const c=s(f,h),g=new r(f,h,o);-1===c?n.push(g):n[c]=g},this.on=this.register,this.subscribe=this.register,this.once=(t,e)=>{if(!t)return;const n=new r(t,"",e);i.push(n)},this.onMany=(t,e)=>{e&&Object.keys(e).forEach((r=>{this.on(r,t,e[r])}))},this.unregister=(t,e)=>{if(!t)return;let r=0;if("all"!==(e||"all"))for(r=s(t,e),-1!==r&&n.splice(r,1),r=i.length;r;)r-=1,i[r].name===t&&i.splice(r,1);else for(r=n.length;r;)r-=1,"all"===n[r].id&&n.splice(r,1)},this.off=this.unregister,this.unsubscribe=this.unregister,this.offAll=t=>{let e=n.length;for(;e;)e-=1,n[e].id===t&&n.splice(e,1)},this.trigger=(t,e)=>{const r=(t=>{const e=[];for(let r=0,i=n.length;r<i;r+=1)n[r].name===t&&e.push(n[r]);return e})(t);for(let n=0,i=r.length;n<i;n+=1)r[n].func(e,t);let s=i.length;for(;s;)s-=1,i[s].name===t&&(i[s].func(e,t),i.splice(s,1))},this.emit=this.trigger,this.publish=this.trigger,this.propagate=(t,e)=>{this.trigger(e,t)},this.isRegistered=(t,e)=>{let r=n.length;for(;r;)if(r-=1,n[r].id===e&&n[r].name===t)return!0;return!1}}const i=(t,e)=>{let r=!1;for(var n in e)if(s.object(t[n]))r=i(t[n],e[n]);else if(s.array(t[n]))for(var u=0,l=e[n].length;u<l;u++)s.object(t[n][u])?r=i(t[n][u],e[n][u]):t[n][u]!==e[n][u]&&(t[n][u]=e[n][u],r=!0);else t[n]!==e[n]&&(t[n]=e[n],r=!0);return r},s={object:t=>"object"==typeof t&&null!==t,number:t=>"number"==typeof t,string:t=>"string"==typeof t,array:t=>Array.isArray(t),undef:t=>void 0===t},u=t=>s.number(t)||s.string(t);function l(t){const e=this;Object.assign(this,new n);const r=t.itemConstructor;let l=!1;u(r.prototype.id)||(r.prototype.id=-1,l=!0);const f=()=>{let t=h.length;return e.getAllIds().reduce(((t,e)=>Math.max(t,e)),t)},o=t.itemName;this.getName=function(){return o};const h=[];this.clear=function(){h.splice(0,h.length)},this.add=function(t){return!!s.object(t)&&(t=new r(t),l&&-1===t.id&&(t.id=f()),h.push(t),!0)},this.getAll=function(){return h},this.getAllIds=function(){return h.map((t=>t.id))},this.getCopies=function(){return h.map((t=>new r(t)))},this.getById=function(t){return e.getByAttribute("id",t)},this.getIndex=function(t){if(!u(t))return!1;let e=h.length;for(;e--;)if(t===h[e].id)return e;return-1};const c=(t,e)=>{if(-1!==e.indexOf(".")){let r=e.split(".").filter((t=>!!t.trim())),n={...t};for(let t=0,e=r.length;t<e;t++)n=n[r[t]];return n}return t[e]};this.getByAttribute=function(t,e){if(!s.string(t)||s.undef(e))return null;let r=h.length;for(;r--;){if(e===c(h[r],t))return h[r]}return null},this.getAllByAttribute=function(t,e){let r=[];if(!s.string(t)||s.undef(e))return r;for(var n=0,i=h.length;n<i;n++){e===c(h[n],t)&&r.push(h[n])}return r},this.setAttributes=function(t,r){if(!u(t)||!s.object(r))return!1;if(s.string(t)&&!t.trim())return!1;let n=e.getById(t);return null!==n&&i(n,r)},this.insert=function(t,n){if(!u(t)||!s.array(n))return!1;let i=e.getIndex(t);if(-1===i)return!1;let o=[];for(let t=0,r=n.length;t<r;t++)e.update(n[t])||o.push(n[t]);return o.forEach(((t,e)=>{t=new r(t),l&&-1===t.id&&(t.id=f()),h.splice(i+1+e,0,t)})),!0},this.upsert=this.insert,this.update=function(t){if(!s.object(t)||!u(t.id))return!1;if(-1===e.getIndex(t.id))return!1;let r=h.length;for(;r--;)if(h[r].id===t.id&&i(h[r],t))return e.emit(`updated-${o}-${t.id}`,t),!0;return!1},this.remove=function(t){if(!u(t))return!1;let e=h.length;for(;e--;)if(h[e].id===t)return h.splice(e,1),!0;return!1}}export{l as default};
