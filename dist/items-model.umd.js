!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).emitter=e()}(this,(function(){"use strict";const t=function(t){return"string"==typeof t},e=function(t){return"function"==typeof t};function n(t,e,n){this.name=t,this.id=e,this.func=n}function i(){const i=[],r=[],s=(t,e)=>{let n=i.length;for(;n;)if(n-=1,i[n].name===t&&i[n].id===e)return n;return-1};this.register=(r,u,o)=>{const f=r;let l=o,h=u;if(e(h))if(t(l)){const t=l;l=h,h=t}else l=u,h="all";if(!f)return;const c=s(f,h),g=new n(f,h,l);-1===c?i.push(g):i[c]=g},this.on=this.register,this.subscribe=this.register,this.once=(t,e)=>{if(!t)return;const i=new n(t,"",e);r.push(i)},this.onMany=(t,e)=>{e&&Object.keys(e).forEach((n=>{this.on(n,t,e[n])}))},this.unregister=(t,e)=>{if(!t)return;let n=0;if("all"!==(e||"all"))for(n=s(t,e),-1!==n&&i.splice(n,1),n=r.length;n;)n-=1,r[n].name===t&&r.splice(n,1);else for(n=i.length;n;)n-=1,"all"===i[n].id&&i.splice(n,1)},this.off=this.unregister,this.unsubscribe=this.unregister,this.offAll=t=>{let e=i.length;for(;e;)e-=1,i[e].id===t&&i.splice(e,1)},this.trigger=(t,e)=>{const n=(t=>{const e=[];for(let n=0,r=i.length;n<r;n+=1)i[n].name===t&&e.push(i[n]);return e})(t);for(let i=0,r=n.length;i<r;i+=1)n[i].func(e,t);let s=r.length;for(;s;)s-=1,r[s].name===t&&(r[s].func(e,t),r.splice(s,1))},this.emit=this.trigger,this.publish=this.trigger,this.propagate=(t,e)=>{this.trigger(e,t)},this.isRegistered=(t,e)=>{let n=i.length;for(;n;)if(n-=1,i[n].id===e&&i[n].name===t)return!0;return!1}}const r=(t,e)=>{let n=!1;for(var i in e)if(s.object(t[i]))n=r(t[i],e[i]);else if(s.array(t[i]))for(var u=0,o=e[i].length;u<o;u++)s.object(t[i][u])?n=r(t[i][u],e[i][u]):t[i][u]!==e[i][u]&&(t[i][u]=e[i][u],n=!0);else t[i]!==e[i]&&(t[i]=e[i],n=!0);return n},s={object:t=>"object"==typeof t&&null!==t,number:t=>"number"==typeof t,string:t=>"string"==typeof t,array:t=>Array.isArray(t),undef:t=>void 0===t},u=t=>s.number(t)||s.string(t);return function(t){const e=this;Object.assign(this,new i);const n=t.itemConstructor;let o=!1;u(n.prototype.id)||(n.prototype.id=-1,o=!0);const f=()=>{let t=h.length;return e.getAllIds().reduce(((t,e)=>Math.max(t,e)),t)},l=t.itemName;this.getName=function(){return l};const h=[];this.clear=function(){h.splice(0,h.length)},this.add=function(t){return!!s.object(t)&&(t=new n(t),o&&-1===t.id&&(t.id=f()),h.push(t),!0)},this.getAll=function(){return h},this.getAllIds=function(){return h.map((t=>t.id))},this.getCopies=function(){return h.map((t=>new n(t)))},this.getById=function(t){return e.getByAttribute("id",t)},this.getIndex=function(t){if(!u(t))return!1;let e=h.length;for(;e--;)if(t===h[e].id)return e;return-1};const c=(t,e)=>{if(-1!==e.indexOf(".")){let n=e.split(".").filter((t=>!!t.trim())),i={...t};for(let t=0,e=n.length;t<e;t++)i=i[n[t]];return i}return t[e]};this.getByAttribute=function(t,e){if(!s.string(t)||s.undef(e))return null;let n=h.length;for(;n--;){if(e===c(h[n],t))return h[n]}return null},this.getAllByAttribute=function(t,e){let n=[];if(!s.string(t)||s.undef(e))return n;for(var i=0,r=h.length;i<r;i++){e===c(h[i],t)&&n.push(h[i])}return n},this.setAttributes=function(t,n){if(!u(t)||!s.object(n))return!1;if(s.string(t)&&!t.trim())return!1;let i=e.getById(t);return null!==i&&r(i,n)},this.insert=function(t,i){if(!u(t)||!s.array(i))return!1;let r=e.getIndex(t);if(-1===r)return!1;let l=[];for(let t=0,n=i.length;t<n;t++)e.update(i[t])||l.push(i[t]);return l.forEach(((t,e)=>{t=new n(t),o&&-1===t.id&&(t.id=f()),h.splice(r+1+e,0,t)})),!0},this.upsert=this.insert,this.update=function(t){if(!s.object(t)||!u(t.id))return!1;if(-1===e.getIndex(t.id))return!1;let n=h.length;for(;n--;)if(h[n].id===t.id&&r(h[n],t))return e.emit(`updated-${l}-${t.id}`,t),!0;return!1},this.remove=function(t){if(!u(t))return!1;let e=h.length;for(;e--;)if(h[e].id===t)return h.splice(e,1),!0;return!1}}}));
