!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["items-model"]=e()}(this,(function(){"use strict";const t={string:function(t){return"string"==typeof t},object:function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},array:function(t){return Array.isArray(t)},bool:function(t){return"boolean"==typeof t},number:function(t){return"number"==typeof t},func:function(t){return"function"==typeof t},nul:function(t){return null===t},undef:function(t){return void 0===t||void 0===t}};function e(t,e,r){this.name=t,this.id=e,this.func=r}function r(){const r=[],i=[],n=(t,e)=>{let i=r.length;for(;i;)if(i-=1,r[i].name===t&&r[i].id===e)return i;return-1};this.register=(i,s,u)=>{const o=i;let l=u,f=s;if(t.func(f))if(t.string(l)){const t=l;l=f,f=t}else l=s,f="all";if(!o)return;const c=n(o,f),d=new e(o,f,l);-1===c?r.push(d):r[c]=d},this.on=this.register,this.subscribe=this.register,this.once=(t,r)=>{if(!t)return;const n=new e(t,"",r);i.push(n)},this.onMany=(t,e)=>{e&&Object.keys(e).forEach((r=>{this.on(r,t,e[r])}))},this.unregister=(t,e)=>{if(!t)return;let s=0;if("all"!==(e||"all"))s=n(t,e),-1!==s&&r.splice(s,1);else{for(s=r.length;s;)s-=1,"all"===r[s].id&&r.splice(s,1);for(s=i.length;s;)s-=1,i[s].name===t&&i.splice(s,1)}},this.off=this.unregister,this.unsubscribe=this.unregister,this.offAll=t=>{let e=r.length;for(;e;)e-=1,r[e].id===t&&r.splice(e,1)},this.trigger=(t,e)=>{const n=(t=>{const e=[];for(let i=0,n=r.length;i<n;i+=1)r[i].name===t&&e.push(r[i]);return e})(t);for(let r=0,i=n.length;r<i;r+=1)n[r].func(e,t);let s=i.length;for(;s;)s-=1,i[s].name===t&&(i[s].func(e,t),i.splice(s,1))},this.emit=this.trigger,this.publish=this.trigger,this.propagate=(t,e)=>{this.trigger(e,t)},this.isRegistered=(t,e)=>{const n=e||"all";let s=r.length;for(;s;)if(s-=1,r[s].id===n&&r[s].name===t)return!0;for(s=i.length;s;)if(s-=1,i[s].name===t)return!0;return!1}}const i={object:t=>"object"==typeof t&&null!==t,number:t=>"number"==typeof t,string:t=>"string"==typeof t,array:t=>Array.isArray(t),undef:t=>void 0===t,validID:t=>i.number(t)||i.string(t)},n=(t,e)=>{let r=!1;return!(!i.object(t)||!i.object(e))&&(Object.keys(e).forEach((s=>{if(i.object(t[s]))r=n(t[s],e[s]);else if(i.array(t[s])&&i.array(e[s]))for(var u=0,o=e[s].length;u<o;u++)i.object(t[s][u])?r=n(t[s][u],e[s][u]):t[s][u]!==e[s][u]&&(t[s][u]=e[s][u],r=!0);else t[s]!==e[s]&&(t[s]=e[s],r=!0)})),r)};return function(t){const e=this;Object.assign(this,new r);const s=t.itemConstructor;let u=!1;i.validID(s.prototype.id)||(s.prototype.id=-1,u=!0);const o=()=>{let t=f.length;return e.getAllIds().reduce(((t,e)=>Math.max(t,e)),t)},l=t.itemName;this.getName=function(){return l};const f=new Map,c=new Map;this.clear=function(){f.clear(),c.clear()},this.add=function(t){return!!i.object(t)&&(t=new s(t),u&&-1===t.id&&(t.id=o()),f.set(t.id,t),e.emit(`added-${l}`,t),((t,r)=>{const i=r||f.size-1;c.set(t,i),e.emit(`indexed-${l}`,`id: ${t}, index: ${i}`)})(t.id),!0)},this.getAll=function(){return Array.from(f.values())},this.getAllIds=function(){return Array.from(f.keys()).filter((t=>i.string(t)||i.number(t)))};const d=window&&window.structuredClone?structuredClone:t=>Object.assign({},t);this.getCopies=function(){return e.getAll().map((t=>d(t)))},this.getCopy=function(t){let e=f.get(t);return e?d(e):e},this.getById=function(t){return f.get(t)||null},this.getIndex=function(t){if(!i.validID(t))return-1;let e=c.get(t);return i.undef(e)?-1:e};const h=(t,e)=>{if(e.includes(".")){let r=e.split(".").filter((t=>!!t.trim())),i={...t};for(let t=0,e=r.length;t<e;t++)i=i[r[t]];return i}return t[e]};this.getByAttribute=function(t,e){if(!i.string(t)||i.undef(e))return null;for(let r of f.values()){if(h(r,t)===e)return r}return null},this.getFirstByAttribute=this.getByAttribute,this.getAllByAttribute=function(t,e){let r=[];if(!i.string(t)||i.undef(e))return r;for(let i of f.values()){e===h(i,t)&&r.push(i)}return r},this.setAttributes=function(t,r){if(!i.validID(t)||!i.object(r))return!1;if(i.string(t)&&!t.trim())return!1;let s=e.getById(t);return null!==s&&(!!n(s,r)&&(f.set(s.id,s),e.emit(`set-${l}-${s.id}`,s),e.emit(`set-${l}`,s),!0))},this.setAttributesByAttribute=function(t,r,s){if(!i.string(t)||!i.object(s))return[];if(s.id&&delete s.id,Object.keys(s).length<1)return[];return this.getAllByAttribute(t,r).map((t=>n(t,s)?(f.set(t.id,t),e.emit(`set-${l}`,t),{[t.id]:!0}):{[t.id]:!1}))},this.insert=function(t,r){if(!i.validID(t)||!i.array(r))return!1;let n=e.getIndex(t);if(-1===n)return!1;let d=[];for(let t=0,i=r.length;t<i;t++)e.update(r[t])||d.push(r[t]);const h=Array.from(f.values());return d.forEach(((t,r)=>{t=new s(t),u&&-1===t.id&&(t.id=o());const i=n+1+r;h.splice(i,0,t),e.emit(`inserted-${l}-${t.id}`,t),e.emit(`inserted-${l}`,t)})),e.clear(),h.forEach(((t,e)=>{f.set(t.id,t),c.set(t.id,e)})),!0},this.upsert=this.insert,this.update=function(t){if(!i.object(t)||!i.validID(t.id))return!1;if(-1===e.getIndex(t.id))return!1;let r=e.getById(t.id);return!!n(r,t)&&(f.set(t.id,r),e.emit(`updated-${l}-${t.id}`,r),e.emit(`updated-${l}`,r),!0)},this.remove=function(t){if(!i.validID(t))return!1;if(f.delete(t)){e.emit(`removed-${l}-${t}`),e.emit(`removed-${l}`,t);const r=c.get(t);return c.delete(t),c.forEach(((t,e)=>{t>=r&&c.set(e,t-1)})),!0}return!1}}}));
