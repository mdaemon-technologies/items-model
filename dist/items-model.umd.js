!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ItemsModel=t()}(this,(function(){"use strict";const e={string:function(e){return"string"==typeof e},object:function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},array:function(e){return Array.isArray(e)},bool:function(e){return"boolean"==typeof e},number:function(e){return"number"==typeof e},func:function(e){return"function"==typeof e},nul:function(e){return null===e},undef:function(e){return void 0===e||void 0===e}};function t(t,n,r,i){this.name=t,this.namespace=n,this.func=r,this.priority=e.number(i)?i:1}function n(n){this.config={},Object.defineProperty(this.config,"maxListeners",{value:n&&"number"==typeof n.maxListeners?n.maxListeners:50,writable:!1,enumerable:!0}),Object.defineProperty(this.config,"maxOnceListeners",{value:n&&"number"==typeof n.maxOnceListeners?n.maxOnceListeners:50,writable:!1,enumerable:!0});const r=[],i=[],s=e=>r.filter((t=>t.name===e)).length>=this.config.maxListeners,o=e=>i.filter((t=>t.name===e)).length>=this.config.maxListeners,u=(e,t)=>{let n=r.length;for(;n;)if(n-=1,r[n].name===e&&r[n].namespace===t)return n;return-1};this.register=(n,i,o,l)=>{if(!n)return;if(void 0!==l&&!e.number(l))throw new Error("priority must be a number");if(e.func(i))if(e.string(o)){const e=o;o=i,i=e}else e.number(o)&&(l=o),o=i,i="all";const f=u(n,i),a=new t(n,i,o,l);-1===f?s(n)?console.warn(`Max listeners reached for event ${n}`):r.push(a):r[f]=a,r.sort(((e,t)=>e.priority===t.priority?0:e.priority<t.priority?1:-1))},this.on=this.register,this.subscribe=this.register,this.once=(e,n)=>{if(!e)return;const r=new t(e,"",n);o(e)?console.warn(`Max once listeners reached for event ${e}`):i.push(r)},this.onMany=(e,t)=>{t&&Object.keys(t).forEach((n=>{this.on(n,e,t[n])}))},this.unregister=(e,t)=>{if(!e)return;let n=0;if("all"!==(t=t||"all"))n=u(e,t),-1!==n&&r.splice(n,1);else{for(n=r.length;n;)n-=1,r[n].name===e&&"all"===r[n].namespace&&r.splice(n,1);for(n=i.length;n;)n-=1,i[n].name===e&&i.splice(n,1)}},this.off=this.unregister,this.unsubscribe=this.unregister,this.offAll=e=>{let t=r.length;for(;t;)t-=1,r[t].namespace===e&&r.splice(t,1)},this.trigger=(e,t)=>{const n=(e=>{const t=[];for(let n=0,i=r.length;n<i;n+=1)((r[n].name.indexOf("*")>-1||r[n].name.indexOf("?")>-1)&&new RegExp(r[n].name.replace(/\*/g,".*")).test(e)||r[n].name===e)&&t.push(r[n]);return t})(e);for(let r=0,i=n.length;r<i;r+=1)n[r].func(t,e);((e,t)=>{let n=i.length;for(;n;)n-=1,((i[n].name.indexOf("*")>-1||i[n].name.indexOf("?")>-1)&&new RegExp(i[n].name.replace(/\*/g,".*").replace(/\?/g,".")).test(e)||i[n].name===e)&&(i[n].func(t,e),i.splice(n,1))})(e,t)},this.emit=this.trigger,this.publish=this.trigger,this.propagate=(e,t)=>{this.trigger(t,e)},this.isRegistered=(e,t)=>{t=t||"all";let n=r.length;for(;n;)if(n-=1,r[n].namespace===t&&r[n].name===e)return!0;for(n=i.length;n;)if(n-=1,i[n].name===e)return!0;return!1}}n.HIGH_PRIORITY=2,n.NORMAL_PRIORITY=1,n.LOW_PRIORITY=0;const r={object:e=>"object"==typeof e&&null!==e,number:e=>"number"==typeof e,string:e=>"string"==typeof e,array:e=>Array.isArray(e),undef:e=>void 0===e,validID:e=>r.number(e)||r.string(e)},i=(e,t)=>{let n=!1;return!(!r.object(e)||!r.object(t))&&(Object.keys(t).forEach((s=>{if(r.object(e[s]))n=i(e[s],t[s]);else if(r.array(e[s])&&r.array(t[s]))for(var o=0,u=t[s].length;o<u;o++)r.object(e[s][o])?n=i(e[s][o],t[s][o]):e[s][o]!==t[s][o]&&(e[s][o]=t[s][o],n=!0);else e[s]!==t[s]&&(e[s]=t[s],n=!0)})),n)};return function(e){const t=this;Object.assign(this,new n);const s=e.itemConstructor;let o=!1;r.validID(s.prototype.id)||(s.prototype.id=-1,o=!0);const u=()=>{let e=f.length;return t.getAllIds().reduce(((e,t)=>Math.max(e,t)),e)},l=e.itemName;this.getName=function(){return l};const f=new Map,a=new Map;this.clear=function(){f.clear(),a.clear()},this.add=function(e){return!!r.object(e)&&(e=new s(e),o&&-1===e.id&&(e.id=u()),f.set(e.id,e),t.emit(`added-${l}`,e),((e,n)=>{const r=n||f.size-1;a.set(e,r),t.emit(`indexed-${l}`,`id: ${e}, index: ${r}`)})(e.id),!0)},this.addAll=function(e){return!!r.array(e)&&(e.forEach((e=>{t.add(e)})),!0)},this.getAll=function(){return Array.from(f.values())},this.getAllIds=function(){return Array.from(f.keys()).filter((e=>r.string(e)||r.number(e)))};const c=window&&window.structuredClone?structuredClone:e=>Object.assign({},e);this.getCopies=function(){return t.getAll().map((e=>c(e)))},this.getCopy=function(e){let t=f.get(e);return t?c(t):t},this.getById=function(e){return f.get(e)||null},this.getIndex=function(e){if(!r.validID(e))return-1;let t=a.get(e);return r.undef(t)?-1:t};const d=(e,t)=>{if(t.includes(".")){let n=t.split(".").filter((e=>!!e.trim())),r={...e};for(let e=0,t=n.length;e<t;e++)r=r[n[e]];return r}return e[t]};this.getByAttribute=function(e,t){if(!r.string(e)||r.undef(t))return null;for(let n of f.values()){if(d(n,e)===t)return n}return null},this.getFirstByAttribute=this.getByAttribute,this.getAllByAttribute=function(e,t){let n=[];if(!r.string(e)||r.undef(t))return n;for(let r of f.values()){t===d(r,e)&&n.push(r)}return n},this.setAttributes=function(e,n){if(!r.validID(e)||!r.object(n))return!1;if(r.string(e)&&!e.trim())return!1;let s=t.getById(e);return null!==s&&(!!i(s,n)&&(f.set(s.id,s),t.emit(`set-${l}`,s),!0))},this.setAttributesByAttribute=function(e,n,s){if(!r.string(e)||!r.object(s))return[];if(s.id&&delete s.id,Object.keys(s).length<1)return[];return this.getAllByAttribute(e,n).map((e=>i(e,s)?(f.set(e.id,e),t.emit(`set-${l}`,e),{[e.id]:!0}):{[e.id]:!1}))},this.insert=function(e,n){if(!r.validID(e)||!r.array(n))return!1;let i=t.getIndex(e);if(-1===i)return!1;let c=[];for(let e=0,r=n.length;e<r;e++)t.update(n[e])||c.push(n[e]);const d=Array.from(f.values());return c.forEach(((e,n)=>{e=new s(e),o&&-1===e.id&&(e.id=u());const r=i+1+n;d.splice(r,0,e),t.emit(`inserted-${l}`,e)})),t.clear(),d.forEach(((e,t)=>{f.set(e.id,e),a.set(e.id,t)})),!0},this.upsert=this.insert,this.update=function(e){if(!r.object(e)||!r.validID(e.id))return!1;if(-1===t.getIndex(e.id))return!1;let n=t.getById(e.id);return!!i(n,e)&&(f.set(e.id,n),t.emit(`updated-${l}`,n),!0)},this.remove=function(e){if(!r.validID(e))return!1;if(f.delete(e)){t.emit(`removed-${l}`,e);const n=a.get(e);return a.delete(e),a.forEach(((e,t)=>{e>=n&&a.set(t,e-1)})),!0}return!1}}}));
